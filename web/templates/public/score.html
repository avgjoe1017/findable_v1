{% extends "base.html" %}

{% block title %}Findable Score: {{ score }}/100 - {{ domain }}{% endblock %}

{% block head %}
<!-- Open Graph for social sharing -->
<meta property="og:title" content="{{ og_title }}">
<meta property="og:description" content="{{ og_description }}">
<meta property="og:type" content="website">
<meta property="og:url" content="{{ shareable_url }}">
<meta property="og:image" content="{{ request.base_url }}score/{{ shareable_id }}/og.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ og_title }}">
<meta name="twitter:description" content="{{ og_description }}">
<meta name="twitter:image" content="{{ request.base_url }}score/{{ shareable_id }}/og.png">

<style>
    .score-ring {
        filter: drop-shadow(0 0 30px rgba(20, 184, 166, 0.3));
    }
    .pillar-bar {
        transition: width 1s ease-out;
    }
    @keyframes score-count {
        from { opacity: 0; transform: scale(0.5); }
        to { opacity: 1; transform: scale(1); }
    }
    .score-number {
        animation: score-count 0.8s ease-out;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen">
    <!-- Header -->
    <header class="border-b border-slate-800 px-4 py-4">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <a href="/audit" class="flex items-center gap-2">
                <span class="text-xl font-bold text-white">Findable</span>
                <span class="text-xl font-light text-teal-400">Score</span>
            </a>
            <a href="/audit" class="text-sm text-teal-400 hover:text-teal-300 transition-colors">
                Check another site &rarr;
            </a>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-12">
        <!-- Score Hero -->
        <div class="text-center mb-12">
            <p class="text-slate-400 text-sm uppercase tracking-widest mb-4">{{ domain }}</p>

            <!-- Score Ring -->
            <div class="relative w-48 h-48 mx-auto mb-6 score-ring">
                <svg class="w-full h-full transform -rotate-90" viewBox="0 0 120 120">
                    <!-- Background ring -->
                    <circle cx="60" cy="60" r="52" fill="none" stroke="#1e293b" stroke-width="10"/>
                    <!-- Score arc -->
                    {% set circumference = 326.7 %}
                    {% set offset = circumference - (circumference * score / 100) %}
                    <circle cx="60" cy="60" r="52" fill="none"
                        stroke="{% if score >= 70 %}#14b8a6{% elif score >= 55 %}#eab308{% elif score >= 40 %}#f97316{% else %}#ef4444{% endif %}"
                        stroke-width="10"
                        stroke-dasharray="{{ circumference }}"
                        stroke-dashoffset="{{ offset }}"
                        stroke-linecap="round"/>
                </svg>
                <div class="absolute inset-0 flex flex-col items-center justify-center">
                    <span class="text-5xl font-bold text-white score-number">{{ score }}</span>
                    <span class="text-sm text-slate-400">/100</span>
                </div>
            </div>

            <h1 class="text-2xl font-bold text-white mb-2">{{ level_label }}</h1>
            <p class="text-slate-400 max-w-md mx-auto">
                {% if score >= 70 %}
                    Your site is well-optimized for AI discovery. Fine-tune for maximum visibility.
                {% elif score >= 55 %}
                    AI can find and cite you. Optimize to become the preferred source.
                {% elif score >= 40 %}
                    Foundation in place, but missing key signals that drive citations.
                {% else %}
                    AI crawlers can't effectively access or cite your content yet.
                {% endif %}
            </p>
        </div>

        <!-- 7-Pillar Breakdown -->
        <div class="bg-slate-900/50 border border-slate-800 rounded-2xl p-6 md:p-8 mb-8">
            <h2 class="text-lg font-semibold text-white mb-6">7-Pillar Breakdown</h2>

            <div class="space-y-4">
                {% for pillar in pillars %}
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-slate-300">{{ pillar.display_name }}</span>
                        <span class="text-sm font-mono {% if pillar.raw_score >= 70 %}text-teal-400{% elif pillar.raw_score >= 40 %}text-yellow-400{% else %}text-red-400{% endif %}">
                            {{ pillar.raw_score|round(0)|int }}/100
                        </span>
                    </div>
                    <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                        <div class="pillar-bar h-full rounded-full {% if pillar.raw_score >= 70 %}bg-teal-500{% elif pillar.raw_score >= 40 %}bg-yellow-500{% else %}bg-red-500{% endif %}"
                             style="width: {{ pillar.raw_score }}%"></div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Top 3 Fixes -->
        {% if top_fixes %}
        <div class="bg-slate-900/50 border border-slate-800 rounded-2xl p-6 md:p-8 mb-8">
            <h2 class="text-lg font-semibold text-white mb-6">Top Fixes</h2>

            <div class="space-y-4">
                {% for fix in top_fixes %}
                <div class="flex gap-4 items-start">
                    <div class="flex-shrink-0 w-8 h-8 rounded-lg bg-teal-500/10 flex items-center justify-center text-teal-400 font-bold text-sm">
                        {{ loop.index }}
                    </div>
                    <div>
                        <h3 class="text-white font-medium text-sm">{{ fix.title }}</h3>
                        <p class="text-slate-400 text-sm mt-1">{{ fix.description }}</p>
                        {% if fix.effort %}
                        <span class="inline-block mt-2 px-2 py-0.5 rounded text-xs
                            {% if fix.effort == 'low' %}bg-green-500/10 text-green-400
                            {% elif fix.effort == 'medium' %}bg-yellow-500/10 text-yellow-400
                            {% else %}bg-red-500/10 text-red-400{% endif %}">
                            {{ fix.effort }} effort
                        </span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- CTA: Full Report -->
        <div class="bg-gradient-to-br from-teal-500/10 to-slate-900 border border-teal-500/20 rounded-2xl p-8 text-center mb-8">
            <h2 class="text-xl font-bold text-white mb-2">Want the full report?</h2>
            <p class="text-slate-400 mb-6">Get detailed analysis, all fixes ranked by impact, competitor benchmarks, and monitoring.</p>
            <a href="/register" class="inline-block px-8 py-3 bg-teal-500 hover:bg-teal-400 text-slate-950 font-bold rounded-xl transition-colors">
                Get Full Report &mdash; Free
            </a>
        </div>

        <!-- Social Share -->
        <div class="text-center mb-12">
            <p class="text-sm text-slate-500 mb-4">Share your Findable Score</p>
            <div class="flex justify-center gap-3">
                <a href="https://twitter.com/intent/tweet?text=My%20Findable%20Score%20is%20{{ score }}/100%20for%20{{ domain }}%20%E2%80%94%20{{ level_label }}%0A%0ACheck%20yours%3A%20{{ shareable_url }}"
                   target="_blank" rel="noopener"
                   class="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm text-slate-300 transition-colors">
                    Share on X
                </a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ shareable_url }}"
                   target="_blank" rel="noopener"
                   class="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm text-slate-300 transition-colors">
                    Share on LinkedIn
                </a>
                <button onclick="navigator.clipboard.writeText('{{ shareable_url }}').then(() => this.textContent = 'Copied!')"
                        class="px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-sm text-slate-300 transition-colors">
                    Copy Link
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="text-center py-6 text-slate-600 text-sm border-t border-slate-900">
        <a href="https://getfindable.online" class="hover:text-teal-400 transition-colors">Findable Score Analyzer</a>
        &middot; Measuring AI sourceability
    </footer>
</div>
{% endblock %}
